{\rtf1\ansi\ansicpg1252\cocoartf2761
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\froman\fcharset0 Times-Roman;\f1\fswiss\fcharset0 Helvetica-Bold;\f2\froman\fcharset0 Times-Bold;
\f3\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;\red0\green0\blue0;}
{\*\expandedcolortbl;;\cssrgb\c0\c0\c0;}
{\*\listtable{\list\listtemplateid1\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid1}
{\list\listtemplateid2\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid101\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid2}
{\list\listtemplateid3\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid201\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid3}
{\list\listtemplateid4\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid301\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid4}
{\list\listtemplateid5\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid401\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid5}
{\list\listtemplateid6\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid501\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid6}
{\list\listtemplateid7\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid601\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid7}
{\list\listtemplateid8\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid701\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid8}
{\list\listtemplateid9\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid801\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid9}}
{\*\listoverridetable{\listoverride\listid1\listoverridecount0\ls1}{\listoverride\listid2\listoverridecount0\ls2}{\listoverride\listid3\listoverridecount0\ls3}{\listoverride\listid4\listoverridecount0\ls4}{\listoverride\listid5\listoverridecount0\ls5}{\listoverride\listid6\listoverridecount0\ls6}{\listoverride\listid7\listoverridecount0\ls7}{\listoverride\listid8\listoverridecount0\ls8}{\listoverride\listid9\listoverridecount0\ls9}}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \

\f1\b\fs34\fsmilli17333 BUSINESS OBJECTIVE:\'a0
\f0\b0\fs24 \
\pard\pardeftab720\li480\fi-480\sa106\partightenfactor0

\f1\b\fs45\fsmilli22667 \cf0 Section 1: Business Performance Overview
\f2\fs36 \
\pard\pardeftab720\sa320\partightenfactor0

\f1\fs34\fsmilli17333 \cf0 Business Questions
\f3\b0 :
\f0\fs24 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls1\ilvl0
\f3\fs34\fsmilli17333 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Which products/categories contribute the most to revenue?\uc0\u8232 \u8232 \
\ls1\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 What is the revenue trend across quarters/years?\uc0\u8232 \u8232 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa320\partightenfactor0
\ls1\ilvl0\cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 How does revenue vary by region/state?\
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \
\pard\pardeftab720\sa320\partightenfactor0

\f1\b\fs34\fsmilli17333 \cf0 Task 1: Revenue by time
\f0\b0\fs24 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa320\partightenfactor0
\ls2\ilvl0
\f1\b\fs34\fsmilli17333 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Revenue & YoY growth by year\
\pard\pardeftab720\partightenfactor0

\f3\b0 \cf0 WITH Yearly_revenue AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 EXTRACT (YEAR FROM created_at) as Year
\f0\fs24 \

\f3\fs34\fsmilli17333 , SUM (Net_Sales) as Revenue_by_year\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM sales\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 GROUP BY EXTRACT (YEAR FROM created_at)\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ),\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 Revenue_with_prev_year AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT Year, revenue_by_year
\f0\fs24 \

\f3\fs34\fsmilli17333 , LAG (Revenue_by_year) OVER (ORDER BY Year) as Prev_year_revenue\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM Yearly_revenue
\f0\fs24 \

\f3\fs34\fsmilli17333 GROUP BY 1,2\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 )
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT year, Revenue_by_year, Prev_year_revenue\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , ROUND (
\f0\fs24 \

\f3\fs34\fsmilli17333 (Revenue_by_year - Prev_year_revenue)*100.0/ NULLIF (Prev_year_revenue,0),2) as YoY\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM Revenue_with_prev_year
\f0\fs24 \
\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls3\ilvl0
\f1\b\fs34\fsmilli17333 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Revenue & YoY growth by quarter\
\pard\pardeftab720\partightenfactor0

\f0\b0\fs24 \cf0 \
\pard\pardeftab720\partightenfactor0

\f3\fs34\fsmilli17333 \cf0 WITH quarter_format AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT
\f0\fs24 \

\f3\fs34\fsmilli17333 EXTRACT (QUARTER FROM created_at) as Quarter\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ,EXTRACT (YEAR FROM created_at) as Year\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , TO_CHAR (created_at, '"Q"Q"-"YYYY') as quarter_year
\f0\fs24 \

\f3\fs34\fsmilli17333 ,SUM (Net_Sales) as Revenue
\f0\fs24 \

\f3\fs34\fsmilli17333 ,COUNT(Sales_id) as Number_of_transactions\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ,SUM(Quantity) as Total_units_sold\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM sales\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 GROUP BY 1,2,3\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 )
\f0\fs24 \

\f3\fs34\fsmilli17333 ,Quarterly_revenue AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT Quarter, Year,quarter_year, Revenue, Number_of_transactions, Total_units_sold\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ,LAG (Revenue) OVER (PARTITION BY Quarter ORDER BY Year) as Prev_quarter_revenue\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM quarter_format
\f0\fs24 \

\f3\fs34\fsmilli17333 )
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT quarter_year, Revenue, Number_of_transactions, Total_units_sold,\'a0 Prev_quarter_revenue\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ,ROUND (
\f0\fs24 \

\f3\fs34\fsmilli17333 (Revenue-Prev_quarter_revenue)*100.0/NULLIF(Prev_quarter_revenue,0),2) as YoY_growth\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM quarterly_revenue\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ORDER BY ROUND ((Revenue-Prev_quarter_revenue)*100.0/NULLIF(Prev_quarter_revenue,0),2) desc\'a0
\f0\fs24 \
\
\
\pard\pardeftab720\sa106\partightenfactor0

\f1\b\fs34\fsmilli17333 \cf0 Task 2: Revenue by product/category
\f2\fs28 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa320\partightenfactor0
\ls4\ilvl0
\f1\fs34\fsmilli17333 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Top 10 products by revenue\
\pard\pardeftab720\partightenfactor0

\f0\b0\fs24 \cf0 \
\pard\pardeftab720\partightenfactor0

\f3\fs34\fsmilli17333 \cf0 SELECT product_Name\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ,SUM(Net_sales) as Revenue\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM sales\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 GROUP BY 1\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ORDER BY 1 DESC
\f0\fs24 \

\f3\fs34\fsmilli17333 LIMIT 10
\f0\fs24 \
\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls5\ilvl0
\f1\b\fs34\fsmilli17333 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Revenue by category\
\pard\pardeftab720\partightenfactor0

\f0\b0\fs24 \cf0 \
\pard\pardeftab720\partightenfactor0

\f3\fs34\fsmilli17333 \cf0 SELECT Category\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ,SUM (Net_sales) as Revenue\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM sales\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 GROUP BY 1\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ORDER BY Category DESC\'a0
\f0\fs24 \
\
\pard\pardeftab720\sa106\partightenfactor0

\f1\b\fs34\fsmilli17333 \cf0 Task 3: Revenue by region
\f2\fs28 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa320\partightenfactor0
\ls6\ilvl0
\f1\fs34\fsmilli17333 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Revenue by city\
\pard\pardeftab720\partightenfactor0

\f0\b0\fs24 \cf0 \
\pard\pardeftab720\partightenfactor0

\f3\fs34\fsmilli17333 \cf0 SELECT customer_city\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , SUM (Net_Sales) as Revenue\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM Sales
\f0\fs24 \

\f3\fs34\fsmilli17333 GROUP BY 1\'a0
\f0\fs24 \
\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls7\ilvl0
\f1\b\fs34\fsmilli17333 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Revenue distribution by state based on customer groups\
\pard\pardeftab720\partightenfactor0

\f0\b0\fs24 \cf0 \
\pard\pardeftab720\partightenfactor0

\f3\fs34\fsmilli17333 \cf0 WITH Customer_AOV AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT customer_id, customer_name, customer_city, customer_state\'a0\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , SUM(Net_sales)/COUNT(Sales_id) as AOV\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , SUM(Net_sales) as net_sales
\f0\fs24 \

\f3\fs34\fsmilli17333 , COUNT (sales_id) as No_of_orders
\f0\fs24 \

\f3\fs34\fsmilli17333 , COUNT (DISTINCT (Customer_id)) as no_of_customer\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM sales\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 GROUP BY 1,2,3,4\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ORDER BY SUM(Net_sales)/COUNT(Sales_id) ASC\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 )\'a0
\f0\fs24 \
\

\f3\fs34\fsmilli17333 ,Quantile AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 PERCENTILE_CONT (0.25) WITHIN GROUP (ORDER BY AOV) as q1 -- 25% KH c\'f3 AOV \uc0\u8804  q1\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , PERCENTILE_CONT (0.5) WITHIN GROUP (ORDER BY AOV) as median --50% KH c\'f3 AOV \uc0\u8804  trung v\u7883 \'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , PERCENTILE_CONT (0.75) WITHIN GROUP (ORDER BY AOV) as q3 --\'a0 75% KH c\'f3 AOV \uc0\u8804  q3
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM Customer_AOV\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 )
\f0\fs24 \
\

\f3\fs34\fsmilli17333 SELECT Customer_AOV.customer_id, Customer_AOV.customer_name, Customer_AOV.customer_city, Customer_AOV.customer_state,\'a0 Customer_AOV.AOV, Customer_AOV.net_sales, Customer_AOV.No_of_orders,Customer_AOV.no_of_customer\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , CASE\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN customer_AOV.AOV <= Quantile.q1 THEN 'Low Group'
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN\'a0 customer_AOV.AOV > Quantile.q1 AND customer_AOV.AOV <= Quantile.Median THEN 'Medium Group'
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN customer_AOV.AOV > Quantile.Median AND customer_AOV.AOV <= Quantile.q3\'a0 THEN 'High Group'
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN customer_AOV.AOV >Quantile.q3 THEN 'Top Group'
\f0\fs24 \

\f3\fs34\fsmilli17333 ELSE 'Undefined'\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 END as Customer_segment\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM Customer_AOV\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 CROSS JOIN Quantile
\f0\fs24 \

\f3\fs34\fsmilli17333 ORDER BY customer_AOV.AOV\'a0
\f0\fs24 \
\
\
\pard\pardeftab720\sa106\partightenfactor0

\f1\b\fs45\fsmilli22667 \cf0 Section 2: Discount Impact
\f2\fs36 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa320\partightenfactor0
\ls8\ilvl0
\f1\fs34\fsmilli17333 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Business question:
\f3\b0  Does discounting have a positive impact on revenue? What is the optimal discount percentage?\
\pard\pardeftab720\partightenfactor0

\f1\b \cf0 Task 1:
\f3\b0  Segment customers (based on AOV) and discount ranges (based on discount percentage) by category.
\f0\fs24 \
\
\pard\pardeftab720\partightenfactor0

\f3\fs34\fsmilli17333 \cf0 WITH time_format AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT category,
\f0\fs24 \

\f3\fs34\fsmilli17333 TO_CHAR (created_at, '"Q"Q-YYYY') as quarter\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , COUNT (sales_id) as No_of_orders\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , SUM (net_sales) as Revenue\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , SUM (discount) as Discount
\f0\fs24 \

\f3\fs34\fsmilli17333 , SUM (gross_sales) as Total_gross_sales\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM sales\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 GROUP BY 1,2\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 )\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , metrics AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT category, quarter, no_of_orders, revenue, discount, total_gross_sales\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ,revenue/NULLIF(No_of_orders,0) as AOV\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , Discount*100.0/NULLIF(Total_gross_sales,0) as Discount_percentage
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM time_format\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 )
\f0\fs24 \

\f3\fs34\fsmilli17333 ,Percentile AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 -- Customer group
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 PERCENTILE_CONT (0.25) WITHIN GROUP (ORDER BY AOV ASC)\'a0 AS G1\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , PERCENTILE_CONT (0.5) WITHIN GROUP (ORDER BY AOV ASC)\'a0 AS G2\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , PERCENTILE_CONT (0.75) WITHIN GROUP (ORDER BY AOV ASC)\'a0 AS G3\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 -- Discount range\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , PERCENTILE_CONT (0.25) WITHIN GROUP (ORDER BY Discount_percentage ASC) as D1
\f0\fs24 \

\f3\fs34\fsmilli17333 , PERCENTILE_CONT (0.5) WITHIN GROUP (ORDER BY Discount_percentage ASC) \'a0 as D2\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , PERCENTILE_CONT (0.75) WITHIN GROUP (ORDER BY Discount_percentage ASC) as D3\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM metrics\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 )
\f0\fs24 \
\

\f3\fs34\fsmilli17333 SELECT metrics.*\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ,CASE\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN metrics.AOV = 0 THEN 'NA'
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN metrics.AOV > 0 AND metrics.AOV <= Percentile.G1 THEN 'Low Group'
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN metrics.AOV\'a0 > Percentile.G1 AND metrics.AOV <= Percentile.G2 THEN 'Medium Group'
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN metrics.AOV > Percentile.G2 AND AOV <= Percentile.G3 THEN 'High Group'
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN metrics.AOV > Percentile.G3 THEN 'Top Group'
\f0\fs24 \

\f3\fs34\fsmilli17333 ELSE 'Undefined'
\f0\fs24 \

\f3\fs34\fsmilli17333 END as Customer_group
\f0\fs24 \
\

\f3\fs34\fsmilli17333 ,CASE\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN metrics.discount_percentage = 0 THEN 'No Discount'
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN metrics.discount_percentage > 0 AND metrics.discount_percentage <= Percentile.D1 THEN 'Low Range'
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN metrics.discount_percentage > Percentile.D1 AND metrics.discount_percentage <= Percentile.D2 THEN 'Medium Range'
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN metrics.discount_percentage > Percentile.D2 AND metrics.discount_percentage <= Percentile.D3 THEN 'High Range'
\f0\fs24 \

\f3\fs34\fsmilli17333 WHEN metrics.discount_percentage > Percentile.D3 THEN 'Top Range'
\f0\fs24 \

\f3\fs34\fsmilli17333 ELSE 'Unvalided'
\f0\fs24 \

\f3\fs34\fsmilli17333 END as Discount_range\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM metrics\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 CROSS JOIN Percentile\'a0
\f0\fs24 \
\
\pard\pardeftab720\sa106\partightenfactor0

\f1\b\fs45\fsmilli22667 \cf0 Section 3: Repeat Purchase Rate
\f2\fs36 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa320\partightenfactor0
\ls9\ilvl0
\f1\fs34\fsmilli17333 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Business question:
\f3\b0  What is the repeat purchase rate by customer segment across quarters?\
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \
\pard\pardeftab720\partightenfactor0

\f3\fs34\fsmilli17333 \cf0 WITH Table1 AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT customer_id, customer_name, customer_state, customer_city\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , TO_CHAR (created_at, '"Q"Q-YYYY') as quarter\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , COUNT (sales_id) as No_of_orders
\f0\fs24 \

\f3\fs34\fsmilli17333 , SUM (Net_sales) as Revenue
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM sales
\f0\fs24 \

\f3\fs34\fsmilli17333 GROUP BY 1,2,3,4,5
\f0\fs24 \

\f3\fs34\fsmilli17333 ),
\f0\fs24 \

\f3\fs34\fsmilli17333 metrics AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT customer_id, customer_name, customer_state, customer_city, quarter, No_of_orders, Revenue
\f0\fs24 \

\f3\fs34\fsmilli17333 , revenue/NULLIF(No_of_orders,0) as AOV\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM Table1
\f0\fs24 \

\f3\fs34\fsmilli17333 ),
\f0\fs24 \

\f3\fs34\fsmilli17333 Quantile AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY AOV ASC) AS G1\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0, PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY AOV ASC) AS G2
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0, PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY AOV ASC) AS G3
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0FROM metrics\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0),
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0Customer_group AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0SELECT metrics.customer_id, metrics.customer_name, metrics.customer_state, metrics.customer_city, metrics.No_of_orders, metrics.Revenue,\'a0 metrics.AOV, metrics.quarter\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0, CASE\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0WHEN metrics.AOV = 0 THEN 'NA'
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0WHEN metrics.AOV >0 AND metrics.AOV < Quantile.G1 THEN 'Low Group'
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0WHEN metrics.AOV > Quantile.G1 AND metrics.AOV <= Quantile.G2 THEN 'Medium Group'
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0WHEN metrics.AOV > Quantile.G2 AND metrics.AOV <= Quantile.G3 THEN 'High Group'
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0WHEN metrics.AOV > Quantile.G3 THEN 'Top Group'
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0ELSE 'Undefined'\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0END AS Customer_segment\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0FROM metrics
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0CROSS JOIN Quantile
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0),
\f0\fs24 \

\f3\fs34\fsmilli17333 \'a0Repurchase AS (
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT Customer_segment, quarter\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , COUNT (DISTINCT customer_id) as total_number_of_Customer\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 , COUNT (DISTINCT customer_id) FILTER (WHERE no_of_orders >=2) as Repeat_customer\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM customer_group\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 GROUP BY 1,2\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 )
\f0\fs24 \

\f3\fs34\fsmilli17333 SELECT Customer_segment, quarter, total_number_of_Customer,\'a0 Repeat_customer\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 ,\'a0 Repeat_customer *100.0/NULLIF(total_number_of_Customer,0) AS Repeat_purchase_rate\'a0
\f0\fs24 \

\f3\fs34\fsmilli17333 FROM Repurchase\'a0
\f0\fs24 \
}